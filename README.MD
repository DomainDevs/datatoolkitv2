# DataToolkit.Library

Una librerÃ­a liviana y extensible de acceso a datos en C# basada en **Dapper**, diseÃ±ada para trabajar con mÃºltiples motores de 
base de datos como SQL Server y Sybase. Incluye soporte para Unit of Work, ejecuciÃ³n de SQL, procedimientos almacenados, 
multi-mapping, metadatos de entidades y mÃ¡s.

---

## âœ¨ CaracterÃ­sticas

* âœ… Soporte multi-DB con `IDbConnectionFactory` y alias
* âœ… EjecuciÃ³n de SQL interpolado (`FromSqlInterpolated`)
* âœ… Multi-mapping con Dapper (`FromSqlMultiMap`)
* âœ… Soporte para transacciones (`UnitOfWork`)
* âœ… Repositorio genÃ©rico (`GenericRepository<T>`)
* âœ… Lectura de metadatos vÃ­a atributos (\[Key], \[Column], \[Required], etc.)
* âœ… Extensible con SPs (`StoredProcedureExecutor`)
* âœ… Preparado para integraciÃ³n con `ModelBuilder` futuro

---

## ğŸ§° InstalaciÃ³n

Agrega el proyecto como referencia en tu soluciÃ³n o compÃ­lalo como paquete NuGet.

---


## ğŸ”§ ConfiguraciÃ³n de servicios (Dependency Injection)

```csharp
//Simple conexiÃ³n, a una base de datos
builder.Services.AddDataToolkitSqlServer(
    "Server=localhost;Database=pruebasdb;User Id=sqluser;Password=contrasena123;" +
    "Pooling=true;Min Pool Size=3;Max Pool Size=30;" +
    "Connection Timeout=15;APP=LIB;Language=us_english;" +
    "Encrypt=True;TrustServerCertificate=True;"
);

//Una conexiÃ³n
builder.Services.AddDataToolkitSqlServer(
    "Server=localhost;Database=pruebasdb;User Id=sqluser;Password=contrasena123;" +
    "Pooling=true;Min Pool Size=3;Max Pool Size=30;" +
    "Connection Timeout=15;APP=LIB;Language=us_english;" +
    "Encrypt=True;TrustServerCertificate=True;",
    alias: "SqlServer");

//O, para mÃºltiples conexiones:
builder.Services.AddDataToolkitWith(options =>
{
    options.AddConnection("SqlServer", "Server=localhost;Database=pruebasdb;User Id=sqluser;Password=contrasena123;" +
    "Pooling=true;Min Pool Size=3;Max Pool Size=30;" +
    "Connection Timeout=15;APP=LIB;Language=us_english;" +
    "Encrypt=True;TrustServerCertificate=True;", DatabaseProvider.SqlServer);
    options.AddConnection("Sybase", "Host=myhost;Port=5000;Database=DB;...", DatabaseProvider.Sybase);
    options.DefaultAlias = "SqlServer";
});
```

## ğŸš€ Ejemplos de uso
Ejecutar un SQL con parÃ¡metros interpolados

var result = sql.FromSqlInterpolated<Empleado>($"SELECT * FROM Empleado WHERE Estado = {1}");

## Lectura metadatos
* [Key]: Se utiliza para especificar la propiedad o propiedades que actuarÃ¡n como clave principal de una entidad
* [DatabaseGenerated(DatabaseGeneratedOption.Identity)]: El valor de la propiedad de identidad depende del proveedor de la base de datos.
* [Column]: Permite especificar el nombre de la columna.
* [Required]: Se utiliza en la declaraciÃ³n de propiedades o campos para indicar que el campo es requerido
* [NotMapped]: Una propiedad de una entidad no debe ser mapeada a una columna en la base de datos
* [JsonIgnore]: no se incluirÃ¡ en la salida JSON generada por el serializador, ni serÃ¡ considerado al deserializar desde JSON
* [ValidateNever]: Si tienes un modelo con varias propiedades y quieres asegurarte de que una de ellas no se valide. 


## Multi-mapping entre entidades

var empleados = sql.FromSqlMultiMap<EmpleadoDto>(new SqlMultiMapRequest
{
    Sql = "EXEC sp_empleados_departamentos_empresas",
    Types = new[] { typeof(Empleado), typeof(Departamento), typeof(Empresa) },
    SplitOn = "DepartamentoId,EmpresaId",
    MapFunction = objects =>
    {
        var e = (Empleado)objects[0];
        var d = (Departamento)objects[1];
        var emp = (Empresa)objects[2];
        return new EmpleadoDto { Nombre = e.Nombre, Departamento = d.Nombre, Empresa = emp.Nombre };
    }
});


## ğŸ§© Estructura del proyecto

DataToolkit.Library/ 
â”œâ”€â”€ Common/ 
â”œâ”€â”€ Connections/ 
â”œâ”€â”€ Extensions/ 
â”œâ”€â”€ Metadata/ 
â”œâ”€â”€ Repositories/ 
â”œâ”€â”€ Sql/ 
â”œâ”€â”€ StoredProcedures/ 
â””â”€â”€ UnitOfWork/ 

## ğŸ“¦ Dependencias
Dapper
AdoNetCore.AseClient
Microsoft.Data.SqlClient

## ğŸ“Œ Requisitos

.NET 6.0 o superior
SQL Server, Sybase u otros motores configurables

## ğŸ“£ Licencia

MIT

## âœï¸ Autor

Fernando Poveda Â· @github.com/DomainDevs